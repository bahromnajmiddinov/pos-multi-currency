<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="pos_multi.StatisticsPopup">
        <!-- CRITICAL: Must wrap in Dialog component! -->
        <Dialog title="'Multi-Currency Statistics'">
            <div class="statistics-popup-content">
                
                <!-- Loading state -->
                <div class="stats-loading text-center py-4" t-if="state.loading">
                    <i class="fa fa-spinner fa-spin me-2"/>
                    Loading…
                </div>

                <!-- Empty state -->
                <div class="stats-empty text-center py-4 text-muted" t-if="!state.loading and state.rows.length === 0">
                    <i class="fa fa-info-circle me-2"/>
                    No multi-currency payments in this session yet.
                </div>

                <!-- Data table -->
                <div class="stats-table-wrap" t-if="!state.loading and state.rows.length > 0">
                    <table class="table table-sm stats-table">
                        <thead>
                            <tr>
                                <th>Currency</th>
                                <th class="text-end">Total (foreign)</th>
                                <th class="text-end">Total (base)</th>
                                <th class="text-end">Txns</th>
                                <th class="text-end">Edited</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="state.rows" t-as="row" t-key="row.currency_id">
                                <tr>
                                    <td class="stats-currency-name"><t t-esc="row.currency_name"/></td>
                                    <td class="text-end stats-amount"><t t-esc="row.totalForeign"/></td>
                                    <td class="text-end stats-amount"><t t-esc="row.totalBase"/></td>
                                    <td class="text-end"><t t-esc="row.transaction_count"/></td>
                                    <td class="text-end">
                                        <t t-if="row.manually_edited_count > 0">
                                            <span class="badge bg-warning text-dark">
                                                <t t-esc="row.manually_edited_count"/>
                                            </span>
                                        </t>
                                        <t t-else="">—</t>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                        <tfoot>
                            <tr class="stats-totals fw-bold">
                                <td><strong>Totals</strong></td>
                                <td class="text-end">—</td>
                                <td class="text-end stats-amount"><t t-esc="grandTotalBase"/></td>
                                <td class="text-end"><t t-esc="grandTotalTxns"/></td>
                                <td class="text-end"><t t-esc="grandTotalEdited"/></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

            </div>

            <!-- Footer with Close button -->
            <t t-set-slot="footer">
                <button class="btn btn-secondary" t-on-click="onClose">
                    Close
                </button>
            </t>
        </Dialog>
    </t>

</templates>